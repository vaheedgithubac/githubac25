## ğŸ§  Big Picture (understand first)
```text
Private Docker Registry
        â†‘
Docker credentials (Secret)
        â†‘
ServiceAccount
        â†‘
Pod / Deployment
```
- Pods do NOT talk to Docker Hub directly.
- Kubernetes pulls the image on behalf of the Pod, using the ServiceAccountâ€™s imagePullSecrets.

1ï¸âƒ£ Prerequisites (must-have)
- A **private Docker image**, for example:
```text
docker.io/myusername/my-private-image:latest
```
- Docker Hub:
  - Username
  - Access Token (NOT your password)
- Kubernetes cluster access
- Namespace (weâ€™ll use `app`)

## 2ï¸âƒ£ Create the namespace (if not exists)
```bash
kubectl create namespace app
```
## 3ï¸âƒ£ Create Docker registry Secret (MOST IMPORTANT STEP)  
### âœ… RECOMMENDED & SAFEST METHOD (CLI)  
```bash
kubectl create secret docker-registry dockerhub-secret \
  --docker-server=https://index.docker.io/v1/ \
  --docker-username=DOCKERHUB_USERNAME \
  --docker-password=DOCKERHUB_ACCESS_TOKEN \
  --docker-email=your@email.com \
  -n app
```
**ğŸ”¹ What this does:**  
  - Creates secret of type **kubernetes.io/dockerconfigjson**  
  - Generates valid **.dockerconfigjson**  
  - Handles base64 correctly 

## ğŸ”¹ OR 3.1 You can create your own secret yaml file
**Login to docker hub first using `docker login` command, then only `.dockerconfigjson` will be created automatically**   
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: dockerhub-secret
  namespace: app
type: kubernetes.io/dockerconfigjson
stringData:
  .dockerconfigjson: |
    {
      "auths": {
        "https://index.docker.io/v1/": {
          "username": "DOCKERHUB_USERNAME",
          "password": "DOCKERHUB_ACCESS_TOKEN",
          "auth": "BASE64(username:token)"
        }
      }
    }
```
Note:  
1. If you use `stringData:`, then it's content should be plain text
2. If you use `data:`, then it's content should be `base64` encoded

ğŸ” Verify the secret  
```bash
kubectl get secret dockerhub-secret -n app

kubectl describe secret dockerhub-secret -n app
```
You should see:
```bash
Type: kubernetes.io/dockerconfigjson
```

## 4ï¸âƒ£ Create a ServiceAccount that uses this secret 
```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: app-sa
  namespace: app
imagePullSecrets:
- name: dockerhub-secret
```
Apply it:   
```bash
kubectl apply -f serviceaccount.yaml
```
**ğŸ” Verify ServiceAccount**
```bash
kubectl get sa app-sa -n app -o yaml
```
You MUST see:
```yaml
imagePullSecrets:
- name: dockerhub-secret
```

## 5ï¸âƒ£ Create a Deployment that uses the ServiceAccount
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: private-app
  namespace: app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: private-app
  template:
    metadata:
      labels:
        app: private-app
    spec:
      serviceAccountName: app-sa
      containers:
      - name: app
        image: docker.io/myusername/my-private-image:latest
        imagePullPolicy: Always
```
Apply it:
```bash
kubectl apply -f deployment.yaml
```
## 6ï¸âƒ£ What happens internally (IMPORTANT)
**1. Pod is created**  
**2. Kubernetes sees:**  
```makefile
serviceAccountName: app-sa   
```
**3. ServiceAccount references:**  
```makefile
imagePullSecrets: dockerhub-secret
```
**4. kubelet authenticates to Docker Hub**  
**5. Private image is pulled**  
**6. Container starts**  

## 7ï¸âƒ£ Verify everything works
**Check Pod status**
```bash
kubectl get pods -n app
```
You want:
```makefile
STATUS: Running
```
**If it fails, check events (VERY IMPORTANT)**  
```bash
kubectl describe pod <pod-name> -n app
```
## 8ï¸âƒ£ Common errors & EXACT fixes
**âŒ ImagePullBackOff**  
**Causes:**
  - Wrong image name
  - Wrong tag
  - Secret not attached to ServiceAccount
  - Wrong Docker Hub credentials  
**Fix:**
  - Double-check image name  
  - Recreate secret  
  - Ensure ServiceAccount is used  

## âŒ unauthorized: authentication required
**Causes:**
  - Using Docker password instead of token
  - Token expired or revoked
**Fix:**
  - Create Docker Hub Access Token  
  - Recreate secret  

âŒ Pod stuck in Pending
**Cause:**
  - Image pull failure  
**Fix:**
```bash
kubectl describe pod <pod>
```

## 9ï¸âƒ£ MOST COMMON MISTAKES (90% failures)
âŒ Forgetting serviceAccountName in Deployment  
âŒ Creating secret in wrong namespace  
âŒ Typo in secret name  
âŒ Using latest tag that doesnâ€™t exist  
âŒ Using email/password instead of token  

## ğŸ”Ÿ Docker Hub vs Other Registries    
**ğŸ”¹ Amazon ECR**  
- Use IRSA (BEST) or docker-registry secret  
- Username = `AWS`  
- Password = ECR token  
**ğŸ”¹ GitHub Container Registry** 
```bash
--docker-server=ghcr.io
--docker-username=github-username
--docker-password=ghp_xxx
```
## ğŸ”¹ Google Artifact Registry  
- Use JSON key as password

## ğŸ§  Final mental model
**ServiceAccount = identity**    
**Secret = credentials**   
**Pod = uses identity**  

## âœ… Production best practices  
âœ” One ServiceAccount per app  
âœ” One registry secret per namespace  
âœ” Use tokens, never passwords  
âœ” Rotate tokens periodically  
âœ” For EKS â†’ prefer IRSA  






