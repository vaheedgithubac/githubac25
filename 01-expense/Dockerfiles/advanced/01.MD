## Dockerfile
```text
# Use secure, non-root NGINX image
FROM nginxinc/nginx-unprivileged:alpine

# Remove default server config (important)
RUN rm -f /etc/nginx/conf.d/default.conf

# Copy your custom server config
COPY files/expense.conf /etc/nginx/conf.d/expense.conf

# Copy frontend files
COPY code/. /usr/share/nginx/html/

EXPOSE 8080

# CMD already set in base image to run nginx in foreground
# CMD ["nginx", "-g", "daemon off;"]  # optional, base image has it
```
## Why this works (internals)
**Base image defaults:** `nginxinc/nginx-unprivileged:alpine`
- USER `nginx` ‚Üí already set
- listen `8080` ‚Üí expected
- Correct permissions ‚Üí already done
- CMD ["nginx", "-g", "daemon off;"] ‚Üí already defined
- So your Dockerfile just adds content and config.

`expense.conf`
```text
# This is working perfectly

server {
    
    listen 8080 default_server;  # Treated as default server for every request
    server_name _;

    proxy_http_version 1.1;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        ssi    on;
    }
 
    # Proxy Pass to our Application
    location /api/ { 
        proxy_pass http://expense-backend-node:8080/;
    }

    # Health check for NGINX (static page or simple response)
    location /nginx-health {
        return 200 "NGINX is healthy!";
        add_header Content-Type text/plain;
    } 

    # Nginx Status
    location /nginx-status {
        stub_status on;              # Enable stub_status module
        #allow 127.0.0.1;            # Allow requests from localhost  # 192.168.1.0/24
        #deny all;                    # Deny all other IPs
    }

}
```

## ‚úÖ docker-compose.yml
```yaml
services:
  expense-frontend-nginx:
    image: expense-nginx-img
    container_name: expense-nginx-cont
    ports:
      - "80:8080"
    networks:
      - frontend

    # üîê Security hardening
    read_only: true
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true

    # Writable temp locations (required when read_only = true)
    tmpfs:
      - /var/cache/nginx
      - /run

    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8080/nginx-health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

## ‚úÖ Hardened Kubernetes Deployment (RECOMMENDED)
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: expense-frontend-nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: expense-frontend-nginx
  template:
    metadata:
      labels:
        app: expense-frontend-nginx
    spec:
      containers:
      - name: nginx
        image: expense-nginx-img
        ports:
        - containerPort: 8080

        # üîê Security Context (THIS IS THE KEY PART)
        securityContext:
          runAsNonRoot: true
          runAsUser: 101        # nginx user
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL

        # Writable paths when FS is read-only
        volumeMounts:
        - name: nginx-cache
          mountPath: /var/cache/nginx
        - name: nginx-run
          mountPath: /run

        livenessProbe:
          httpGet:
            path: /nginx-health
            port: 8080
          initialDelaySeconds: 15
          periodSeconds: 30

      volumes:
      - name: nginx-cache
        emptyDir: {}
      - name: nginx-run
        emptyDir: {}
```
